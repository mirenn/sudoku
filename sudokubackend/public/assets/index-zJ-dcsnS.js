(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))l(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();let f=localStorage.getItem("userId");f||(f=self.crypto.randomUUID(),localStorage.setItem("userId",f)),localStorage.setItem("passWord",f);let d=localStorage.getItem("pubUserId");d||(d=self.crypto.randomUUID(),localStorage.setItem("pubUserId",d));const u=self.crypto.randomUUID();let m=localStorage.getItem("roomId");const S=document.getElementById("nick");let v=localStorage.getItem("name");v&&(S.value=v);S.addEventListener("input",e=>{localStorage.setItem("name",e.target.value)});let p,g=null;var i=io();let I=0,a="";O();let h=!0,c=JSON.parse(localStorage.getItem("singlePlayState"));console.log("nagai singleplaystate",c);if(c){let e=!0;if(Object.keys(c.board).forEach(t=>{c.board[t].val==="-"&&(e=!1)}),e)i.emit("requestsingleplay");else for(let t=0;t<9;t++)for(let n=0;n<9;n++){let l=String(t)+String(n);document.getElementById(l).textContent=c.board[l].val}}else for(let e=0;e<9;e++)i.emit("requestsingleplay");i.on("singleplay",function(e){if(console.log("nagai 一人用の場合のデータ",e),c=e,localStorage.setItem("singlePlayState",JSON.stringify(c)),h)for(let t=0;t<9;t++)for(let n=0;n<9;n++){let l=String(t)+String(n);document.getElementById(l).textContent=c.board[l].val}});i.on("connectnum",function(e){console.log("nagai num",e),document.getElementById("waiting_num").textContent="現在の総接続人数"+e});i.emit("requestranking");i.on("ranking",function(e){p=e,console.log("nagai ranking",p),p.sort((o,s)=>s.rate-o.rate);const t=document.getElementById("ranking"),n=document.createElement("tbody");p.forEach(({name:o,rate:s,id:r},w)=>{const y=document.createElement("tr"),B=document.createElement("th"),b=document.createElement("td"),L=document.createElement("td"),k=document.createElement("td"),N=U(s);B.textContent=w+1,b.textContent=r===window.pubUserId?o+"（あなた）":o,L.textContent=s,k.textContent=N,y.appendChild(B),y.appendChild(b),y.appendChild(L),y.appendChild(k),n.appendChild(y)});const l=t.getElementsByTagName("tbody")[0];l&&t.removeChild(l),t.appendChild(n)});function U(e){return e<1500?"Iron":e>=1500&&e<1600?"Bronze":e>=1600&&e<1700?"Silver":e>=1700&&e<1800?"Gold":e>=1800&&e<1900?"Platinum":e>=1900&&e<2e3?"Diamond":e>=2e3&&e<2100?"Master":e>=2100&&e<2200?"Grandmaster":"Challenger"}i.on("match",function(e){h=!1,g=null,x(),a!=="InfiniteMode"?(m=e,localStorage.setItem("roomId",m),document.getElementById("dashboard").classList.remove("d-none"),document.getElementById("disp2").classList.remove("d-none")):(m=null,localStorage.setItem("roomId",m),document.getElementById("disp2").classList.remove("d-none")),document.getElementById("waiting_disp").classList.add("d-none"),document.getElementById("waiting_num").classList.add("d-none");const t=document.getElementById("chatarea");t.value="",document.querySelector("#highLowButton .badge").textContent="4"});i.on("startCountDown",function(e){if(I=e,$("#disp2").text("マッチしました。あと"+String(e)+"秒で開始します。"),e<1&&a!=="TurnMode"){$("#disp2").text("Start");const t=document.getElementsByClassName("numbutton");for(let n=0;n<t.length;n++)t[n].classList.remove("glayout")}else{const t=document.getElementsByClassName("numbutton");for(let n=0;n<t.length;n++)t[n].classList.add("glayout")}});$("#message_form").submit(function(){return i.emit("message",$("#input_msg").val()),$("#input_msg").val(""),!1});i.on("message",function(e){const t=document.getElementById("chatarea");t.value+=e+`
`,t.scrollTop=t.scrollHeight});document.getElementById("highLowButton").addEventListener("click",function(e){if(!(I>0)&&!(document.getElementsByClassName("myClick")[0]===void 0||document.getElementsByClassName("myClick")[0].textContent!=="-")&&!(parseInt(document.querySelector("#highLowButton .badge").textContent)<1)&&document.getElementsByClassName("myClick").length>0){let t={roomId:m,extType:"HIGHORLOW",coordinate:document.getElementsByClassName("myClick")[0].id};console.log("nagai submitExtInfo",t),i.emit("submitExt",t)}});i.on("opponentSelect",function(e){console.log("nagai opponentSelect",e);let t=document.getElementsByClassName("opoClick");for(let n=0;n<t.length;n++)t[n].classList.remove("opoClick");e!==""&&document.getElementById(e).classList.add("opoClick")});i.on("event",function(e){if(e.status==="InCorrect"&&(document.getElementById(e.coordinate).classList.add("cross"),setTimeout(function(){document.getElementById(e.coordinate).classList.remove("cross")},1e3)),e.status==="auto"&&a==="TurnMode"){const t="行"+String(parseInt(e.coordinate[0])+1)+"列"+String(parseInt(e.coordinate[1])+1),n=e.val,l="自動展開:"+t+"："+n,o=document.getElementById("log");o.value+=l+`
`,o.scrollTop=o.scrollHeight,document.getElementById(e.coordinate).classList.add("hutoiborder"),setTimeout(function(){document.getElementById(e.coordinate).classList.remove("hutoiborder")},1e3),document.getElementById("disp2").textContent="自動展開:"+t+"："+n;return}if(e.status==="Correct"||e.status==="InCorrect"){const t=e.matchUserId===d||e.matchUserId===u?"自分":"相手",n="行"+String(parseInt(e.coordinate[0])+1)+"列"+String(parseInt(e.coordinate[1])+1),l=e.status==="Correct"?"正解":"不正解",o=e.val,s=l+":"+t+" "+n+"："+o,r=document.getElementById("log");r.value+=s+`
`,r.scrollTop=r.scrollHeight}else if(e.status==="CheckHighOrLow"){const t=e.matchUserId===d||e.matchUserId===u?"自分":"相手",n="行"+String(parseInt(e.coordinate[0])+1)+"列"+String(parseInt(e.coordinate[1])+1),o="HighOrLow"+":"+t+" "+n,s=document.getElementById("log");s.value+=o+`
`,s.scrollTop=s.scrollHeight}});i.on("state",function(e){g=e;const t=g.board,n=g.points;g.highOrLowHistory&&(g.highOrLowHistory.forEach(s=>{t[s.coordinate].val==="-"&&(t[s.coordinate].val=s.highOrLow)}),document.querySelector("#highLowButton .badge").textContent=e.remainingHighOrLowCount);let l=!0;for(let o=0;o<9;o++)for(let s=0;s<9;s++){const r=String(o)+String(s);document.getElementById(r).textContent!==t[r].val&&(document.getElementById(r).textContent=t[r].val,t[r].id===d||t[r].id===u?document.getElementById(r).classList.add("own"):t[r].id!=="auto"&&t[r].id!=="mada"&&document.getElementById(r).classList.add("opponent")),t[r].val==="-"&&(l=!1)}_(n,l)});i.on("stateInfiniteMode",function(e){g=e;let t=g.board;g.points;let n=!0;for(let l=0;l<9;l++)for(let o=0;o<9;o++){const s=String(l)+String(o);document.getElementById(s).textContent!==t[s].val&&t[s].val!=="-"&&(document.getElementById(s).textContent=t[s].val,t[s].id===d||t[s].id===u?document.getElementById(s).classList.add("own"):t[s].id!=="auto"&&t[s].id!=="mada"&&document.getElementById(s).classList.add("opponent")),t[s].val==="-"&&(n=!1)}n&&x()});i.on("turnCount",e=>{if(console.log("nagai data",e),e.turnUserId===d|e.turnUserId===u){const o=document.getElementsByClassName("numbutton");for(var t=0;t<o.length;t++)o[t].classList.remove("glayout")}else{const o=document.getElementsByClassName("numbutton");for(let s=0;s<o.length;s++)o[s].classList.add("glayout")}if(I>0)return;let n;e.turnUserId===d|e.turnUserId===u?n="自分のターン":e.turnUserId==="auto"?n="オート":n="相手のターン";let l=n+"残り秒数"+e.countdown;document.getElementById("disp2").textContent=l});const E={};i.on("hoverServer",function(e){if(a==="InfiniteMode"){if(e.matchUserId in E){const t=document.getElementById(E[e.matchUserId]);t&&t.classList.remove("opohover")}E[e.matchUserId]=e.id,e.id!==""&&document.getElementById(e.id).classList.add("opohover")}else document.querySelectorAll(".opohover").forEach(n=>{n.classList.remove("opohover")}),e.id!==""&&document.getElementById(e.id).classList.add("opohover")});i.on("connect_error",e=>{console.log("nagai error テスト確認",e),document.getElementById("disp2").textContent="サーバーと通信ができなくなりました"});let C;function O(){console.log("renderemptyboard"),document.querySelectorAll("#sudoku tr td").forEach(t=>{t.addEventListener("mouseover",n=>{i.emit("hover",{id:n.target.id})}),t.addEventListener("click",n=>{H(n)},!1)}),document.querySelector("#sudoku").addEventListener("mouseleave",function(){i.emit("hover",{id:""})});for(let t=1;t<10;t++){let n=document.getElementById(String(t));n.onclick=q}}let M=document.getElementById("go_game");M.onclick=T;function T(e){const t=document.getElementsByName("modeRadio"),n=t.length;for(let l=0;l<n;l++)t.item(l).checked&&(a=t.item(l).value);document.getElementById("waiting_disp").classList.remove("d-none"),document.getElementById("name_button").classList.add("d-none"),a==="SimpleMode"?i.emit("gogameSimpleMode",{roomId:m,passWord:f,subUserId:u,pubUserId:d,name:document.getElementById("nick").value}):a==="TurnMode"?i.emit("gogameTurnMode",{roomId:m,passWord:f,subUserId:u,pubUserId:d,name:document.getElementById("nick").value}):a==="InfiniteMode"&&i.emit("gogameInfiniteMode",{roomId:m,passWord:f,subUserId:u,pubUserId:d,name:document.getElementById("nick").value})}function H(e){let t=!1;if(e.target.classList.contains("myClick")&&(t=!0),C!=null&&C.classList.remove("myClick"),t){i.emit("myselect","");return}C=e.target,C.classList.add("myClick"),i.emit("myselect",e.target.id)}function q(e){if(console.log("nagai select click"),h){if(document.getElementsByClassName("myClick")[0]===void 0||/^[1-9]+$/.test(document.getElementsByClassName("myClick")[0].textContent))return;let t=document.getElementById("sudoku").querySelectorAll("tr");e:for(let l=0;l<t.length;l++)for(let o=0;o<t[l].querySelectorAll("td").length;o++)if(t[l].querySelectorAll("td")[o].classList.contains("myClick")){const s=String(l)+String(o);e.target.textContent===c.answer[l*9+o]?(document.getElementById(s).textContent=e.target.textContent,c.board[s].val=e.target.textContent,localStorage.setItem("singlePlayState",JSON.stringify(c))):(document.getElementById(s).classList.add("cross"),setTimeout(function(){document.getElementById(s).classList.remove("cross")},1e3));break e}let n=!0;Object.keys(c.board).forEach(l=>{c.board[l].val==="-"&&(n=!1)}),n&&i.emit("requestsingleplay")}else if(a==="TurnMode"){if(I>0||document.getElementsByClassName("myClick")[0]===void 0||/^[1-9]+$/.test(document.getElementsByClassName("myClick")[0].textContent))return;if(document.getElementsByClassName("myClick").length>0){let t={roomId:m,coordinate:document.getElementsByClassName("myClick")[0].id,val:e.target.textContent};console.log("nagai submitInfo",t),i.emit("submitTurnMode",t)}}else if(a==="SimpleMode"){if(I>0||document.getElementsByClassName("myClick")[0]===void 0||/^[1-9]+$/.test(document.getElementsByClassName("myClick")[0].textContent))return;if(document.getElementsByClassName("myClick").length>0){let t={roomId:m,coordinate:document.getElementsByClassName("myClick")[0].id,val:e.target.textContent};console.log("nagai submitInfo",t),i.emit("submitSimpleMode",t)}}else if(a==="InfiniteMode"){if(document.getElementsByClassName("myClick")[0]===void 0||/^[1-9]+$/.test(document.getElementsByClassName("myClick")[0].textContent))return;if(document.getElementsByClassName("myClick").length>0){let t={roomId:m,coordinate:document.getElementsByClassName("myClick")[0].id,val:e.target.textContent};console.log("nagai submitInfo",t),i.emit("submitInfiniteMode",t)}}}function _(e,t){let n=0,l=0;if(Object.keys(e).forEach(o=>{o===d||o===u?n=e[o]:l=e[o]}),document.getElementById("point_1").textContent=n,document.getElementById("point_2").textContent=l,t){const o=document.getElementById("log");o.value+=`ゲーム終了
`,o.scrollTop=o.scrollHeight,n>l?document.getElementById("disp2").textContent="Win!!!":n===l?document.getElementById("disp2").textContent="Draw!":document.getElementById("disp2").textContent="Lose",localStorage.removeItem("roomId"),m=null,document.getElementById("name_button").classList.remove("d-none")}}function x(){const e=document.getElementsByClassName("opponent");for(;e.length;)e[0].classList.remove("opponent");const t=document.getElementsByClassName("opohover");for(;t.length;)t[0].classList.remove("opohover");const n=document.getElementsByClassName("own");for(;n.length;)n[0].classList.remove("own");const l=document.getElementsByClassName("opoClick");for(;l.length;)l[0].classList.remove("opoClick")}
